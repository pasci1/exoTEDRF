# ========================= BEGIN DMS CONFIG FILE =============================
#
# NIRISS/SOSS, CLEAR (swap to F277W for the other filter)
#
# ===== Key Parameters ===== 
crds_cache_path: './crds_cache/'
crds_context: 'jwst_1322.pmap'

# where download_observations put the files
input_dir: 'DMS_uncal/'
input_filetag: 'uncal'

# switch to NIRISS/SOSS here:
observing_mode: 'NIRISS/SOSS'
filter_detector: 'CLEAR'

# something short for your outputs
name_tag: 'NIRISS_SOSS_CLEAR'

# ===== Stage 1 Input Files & Parameters =====
DQInitStep:  'run'
EmiCorrStep: 'skip'
SaturationStep: 'run'
ResetStep:   'skip'
SuperBiasStep: 'run'
RefPixStep:  'run'
DarkCurrentStep: 'run'
OneOverFStep_grp: 'run'
LinearityStep: 'run'
JumpStep:    'run'
RampFitStep: 'run'
GainScaleStep: 'run'
hot_pixel_map: None
superbias_method: 'crds'
soss_background_file: 'model_background256.npy'
oof_method: 'scale-achromatic'
soss_timeseries: None
soss_timeseries_o2: None
outlier_maps: None
flag_up_ramp: False
jump_threshold: 15
flag_in_time: True
stage1_kwargs: {}

# ===== Stage 2 Input Files & Parameters =====
AssignWCSStep: 'run'
Extract2DStep: 'skip'
SourceTypeStep: 'run'
WaveCorrStep: 'skip'
FlatFieldStep: 'run'
BackgroundStep: 'run'
OneOverFStep_int: 'skip'
BadPixStep: 'run'
PCAReconstructStep: 'run'
TracingStep: 'run'
miri_background_method: 'median'   # unused
pca_components: 10
remove_components: None
generate_lc: True
smoothing_scale: None
generate_order0_mask: False
f277w: None
stage2_kwargs: {}

# ===== Stage 3 Input Files & Parameters =====
extract_method: 'box'
soss_specprofile: None
st_teff: None
st_logg: None
st_met: None
planet_letter: 'b'
stage3_kwargs: {}

# ===== General Parameters =====
output_tag: ''
run_stages: [1,2,3]
save_results: True
force_redo: True
baseline_ints: [150,-100]
centroids: None
do_plots: False

# ===== Optimize =====
wave_range: null
wave_range_plot: null
ylim_plot: null

# either a List [a,b,...] to sweep over or an Integer c to set as Default

# ===== Stage 1 parameter to sweep =====
# (SOSS only) For 1/f correction; width, in pixels, of inner trace mask.
optimize_soss_inner_mask_width : [40]
# (SOSS only) For 1/f correction; width, in pixels, of outer trace mask.
optimize_soss_outer_mask_width : 70
# (NIRSpec only) For 1/f correction; width, in pixels, of trace mask. [10, 12, 14, 16, 18, 20, 22, 24]
optimize_nirspec_mask_width : 10 # [10, 12, 14, 16, 18, 20]
# For time domain jump detection; sigma threshold for a pixel to be flagged as an outlier. [5,6,7,8,9,10]
optimize_time_jump_threshold : 5 #[5,6,7,8,9]
# time_window in JumpStep [3,5,7,9,11]
optimize_time_window : 7 # [3,5,7,9,11]
 
# ===== Stage 2 parameter to sweep =====
# (MIRI only) For background subtraction; width (in pixels) to mask around the trace.
optimize_miri_trace_width : 20
# (MIRI only) For background subtraction; width (in pixels) of the background region to use on either side of the trace.
optimize_miri_background_width : 14
# For outlier detection; sigma threshold for a pixel to be flagged as an outlier, spatially. [5,6,7,8,9,10,11,12,13,14,15]
optimize_space_outlier_threshold : 5 #[5,6,7,8,9,10,11]
# For outlier detection; sigma threshold for a pixel to be flagged as an outlier, temporally. [5,6,7,8,9,10,11,12,13,14,15]
optimize_time_outlier_threshold : 5 #[5,6,7,8,9,10,11]
# Box size in BadPixStep [2,3,4,5,6,7,8]
optimize_box_size : 7 # [3,4,5,6,7]
# Window size in BadPixStep [3,5,7,9,11]
optimize_window_size : 3 # [3,5,7,9,11]

# ===== Stage 3 parameter to sweep =====
# Box width to extract around the trace center. Passing 'optimize' will find and use the aperture width that minimizes
# the white light curve scatter.[3,4,5,6,7,8,9,10]
optimize_extract_width : 10 # [4,5,6,7,8,9,10]

# ========================= END DMS CONFIG FILE =============================
